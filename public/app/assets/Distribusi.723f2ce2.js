import{u as r,b as v,_ as Y,d as f,F as I,p as M,e as A,c,a as s,f as i,w as u,r as h,o as d,g as x,t as p,n as g,h as _,i as K,j as N,k as B,l as F}from"./index.35ab010d.js";class L{getDownloads(){return r(),v({method:"get",url:r().parseApi("/logdls"),headers:{Authorization:`Bearer ${r().token}`}}).then(t=>t.data)}}const j={components:{},data(){return{date1:null,date2:null,submitted:!1,valid_date:!1,PrintDistribusiDialog:!1,store:r(),Documents:null,DocumentDialog:!1,deleteDocumentDialog:!1,deleteDocumentsDialog:!1,Document:{},selectedDocuments:null,filters:{},submitted:!1,editPickExtra:{tahun:{label:"2022",value:"2022"},categoryDocument:{label:"SK",value:"SK"}},optionsTahun:[{label:"2020",value:"2020"},{label:"2021",value:"2021"},{label:"2022",value:"2022"},{label:"2023",value:"2023"},{label:"2024",value:"2024"},{label:"2025",value:"2025"}],categoryDocument:[{label:"SOP TU",value:"SOP TU"},{label:"SOP GIGI",value:"SOP GIGI"},{label:"SOP KIA",value:"SOP KIA"},{label:"SK TU",value:"SK TU"},{label:"SK GIGI",value:"SK GIGI"},{label:"SK MUTU",value:"SK MUTU"}],uploadUrl:`${location.protocol}//${location.hostname}/api/upload`,editMode:!1}},DownloadsService:null,created(){this.DownloadsService=new L,this.initFilters()},mounted(){this.DownloadsService.getDownloads().then(o=>{this.Documents=o,console.log(this.Documents)}),this.submitted=!1},methods:{validate(){return this.valid_date=this.date1<=this.date2,this.date1&&this.date2&&this.valid_date},formatCurrency(o){if(o)return o.toLocaleString("en-US",{style:"currency",currency:"USD"})},formatDate(o){return f(o).format("YYYY-MM-DD")},openNew(){this.Document={arsips:[],tahun:"2022"},this.submitted=!1,this.editMode=!1,this.DocumentService.getCategory().then(o=>{console.log("cat",o),this.categoryDocument=o.map(t=>({label:t.category,value:t.category}))}),this.DocumentDialog=!0},hideDialog(){this.DocumentDialog=!1,this.submitted=!1,this.Document={}},validateInput(){let o=this.Document;return o.tgl_terbit&&o.title&&o.category},saveDocument(){if(this.submitted=!0,this.validateInput()){let o=r().parseApi("/document/internal"),t;console.log("before",this.Document.tgl_terbit),this.Document.tgl_terbit instanceof Date?t=f(this.Document.tgl_terbit).format("YYYY-MM-DD"):t=f(this.Document.tgl_terbit,"DD-MM-YYYY").format("YYYY-MM-DD"),console.log("validate",t),this.editMode&&(o=r().parseApi("/document/internal/"+this.Document.id)),v({method:"post",url:o,data:{arsips:this.Document.arsips,tgl_terbit:t,title:this.Document.title,type:"INTERNAL",category:this.Document.category,no_sk:this.Document.no_sk,tahun:f(this.Document.tahun).format("YYYY")},headers:{Authorization:`Bearer ${r().token}`}}).then(a=>{console.log("save",a.data),this.DocumentDialog=!1,this.DocumentService.getDocuments().then(w=>{this.Documents=w,console.log(this.Documents)}),this.$toast.add({severity:"success",summary:"Successful",detail:"Document Saved ",life:3e3})})}},editDocument(o){this.Document={...o},console.log("editDoc",this.Document),this.editPickExtra.tahun={label:this.Document.tahun,value:this.Document.tahun},this.editPickExtra.categoryDocument={label:this.Document.category,value:this.Document.category},this.editMode=!0,this.DocumentDialog=!0},confirmDeleteDocument(o){this.Document=o,this.deleteDocumentDialog=!0},deleteDocument(){v({method:"delete",url:r().parseApi("/document/internal/"+this.Document.id),headers:{Authorization:`Bearer ${r().token}`}}).then(o=>{console.log("deleted",o.data),this.deleteDocumentDialog=!1,this.Document={},this.$toast.add({severity:"success",summary:"Successful",detail:"Document Deleted",life:3e3}),this.DocumentService.getDocuments().then(t=>{this.Documents=t,console.log(this.Documents)})})},findIndexById(o){let t=-1;for(let a=0;a<this.Documents.length;a++)if(this.Documents[a].id===o){t=a;break}return t},createId(){let o="";for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<5;a++)o+=t.charAt(Math.floor(Math.random()*t.length));return o},exportCSV(){this.$refs.dt.exportCSV()},confirmDeleteSelected(){this.deleteDocumentsDialog=!0},deleteSelectedDocuments(){console.log(this.selectedDocuments),this.selectedDocuments.forEach(async o=>{let t=await v({method:"delete",url:r().parseApi("/document/internal/"+o.id),headers:{Authorization:`Bearer ${r().token}`}});t=await t.data,console.log("deleting",t.data)}),this.DocumentService.getDocuments().then(o=>{this.Documents=o,console.log(this.Documents)}),this.deleteDocumentsDialog=!1,this.selectedDocuments=null,this.$toast.add({severity:"success",summary:"Successful",detail:"Documents Deleted",life:3e3})},initFilters(){this.filters={global:{value:null,matchMode:I.CONTAINS}}},onCategoryDocumentChange(){console.log(this.Document.categoryDocument),console.log(this.Document.category),this.Document.category=this.editPickExtra.categoryDocument.value},trimSpace(o){return o.replace(" ","")},onBeforeSendUploader(o){o.xhr.setRequestHeader("Authorization",`Bearer ${r().token}`)},onUploadSuccess(o){console.log("sukses",JSON.parse(o.xhr.responseText)),JSON.parse(o.xhr.responseText).forEach(a=>{this.Document.arsips=[...this.Document.arsips,a]})},deleteUpload(o){v({method:"delete",url:r().parseApi("/upload"),data:{storagepath:o},headers:{Authorization:`Bearer ${r().token}`}}).then(t=>{console.log("del",t.data),this.Document.arsips=this.Document.arsips.filter(a=>a.storagepath!=o),this.DocumentService.getDocuments().then(a=>{this.Documents=a,console.log(this.Documents)})})},parseArsipUrls(o){return M(o)},onTahunChange(o){console.log("tahun",this.Document.tahun)},onUploadClickAtTable(o){r().arsipsTemp=o.arsips,r().currentPickDocumentInternal=o,this.$router.push({path:"/view-upload"})},onPrint(){console.log("print"),this.PrintDistribusiDialog=!0},print(){if(this.submitted=!0,this.validate()){let o={date1:f(this.date1).format("YYYY-MM-DD"),date2:f(this.date2).format("YYYY-MM-DD")};window.open(A(`/print/distribusi?start=${o.date1}&end=${o.date2}`),"_blank")}else alert("date tidak sesuai");this.valid_date=!1}}},n=o=>(B("data-v-e6ce06c0"),o=o(),F(),o),O={class:"grid"},z={class:"col-12"},E={class:"card"},G={class:"my-2"},R={class:"flex flex-column md:flex-row md:justify-content-between md:align-items-center"},J=n(()=>s("h5",{class:"m-0"},"Distribusi Document",-1)),q={class:"block mt-2 md:mt-0 p-input-icon-left"},H=n(()=>s("i",{class:"pi pi-search"},null,-1)),W=n(()=>s("span",{class:"p-column-title"},"Tanggal",-1)),Z=n(()=>s("span",{class:"p-column-title"},"No",-1)),Q=n(()=>s("h5",null,"Pilih Periode",-1)),X={class:"p-fluid grid formgrid"},$={class:"field col-12 md:col-6"},ee=n(()=>s("label",{for:"date1"},"Awal",-1)),te={key:0,class:"p-invalid"},oe={class:"field col-12 md:col-6"},le=n(()=>s("label",{for:"date2"},"Akhir",-1)),se={key:0,class:"p-invalid"},ie={class:"p-dialog-footer mr-0"},ne={class:"formgrid grid"},ae={class:"field col-12 md:col-6"},re=n(()=>s("label",{for:"tahun",class:"mb-3"},"Tahun",-1)),ue={class:"field col-12 md:col-6"},ce=n(()=>s("label",{for:"categoryDocument",class:"mb-3"},"Kategori (Pilih kategori untuk bantu isi kategory dokument, bila tidak ada diisi sendiri.)",-1)),de={key:0},me={key:1},he={key:2},De={class:"formgrid grid"},pe={class:"field col-12 md:col-6"},ge=n(()=>s("label",{for:"category",class:"mb-3"},"Kategori Document",-1)),_e={key:0,class:"p-invalid"},fe={class:"field col-12 md:col-6"},be=n(()=>s("label",{for:"titleDocument",class:"mb-3"},"Judul Document",-1)),ve={key:0,class:"p-invalid"},ye={class:"field col-12 md:col-6"},ke=n(()=>s("label",{for:"dateformatmasuk"},"Tgl Terbit Document",-1)),Se={key:0,class:"p-invalid"},xe={class:"field col-12 md:col-6"},we=n(()=>s("label",{for:"noSK"},"No",-1)),Ue=n(()=>s("label",{for:"fileterupload"},"File yg terupload:",-1)),Ce={class:"mt-4 formgrid grid"},Ve={class:"field col-4"},Pe={class:"grid"},Te=["href"],Ye={class:"flex align-items-center justify-content-center bg-yellow-500 font-bold text-gray-900 m-2 px-5 py-3 border-round"},Ie={class:"field"},Me=n(()=>s("label",{for:"upload"},"Upload (setelah tambah file selesai jangan lupa klik upload dulu) ",-1)),Ae={class:"flex align-items-center justify-content-center"},Ke=n(()=>s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Ne={key:0},Be=x("Yakin akan menghapus No Document: "),Fe=x(" karena juga akan menghapus data upload ?"),Le={class:"flex align-items-center justify-content-center"},je=n(()=>s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Oe={key:0};function ze(o,t,a,w,e,m){const U=h("Toast"),D=h("Button"),C=h("Toolbar"),y=h("InputText"),b=h("Column"),V=h("DataTable"),k=h("Calendar"),S=h("Dialog"),P=h("Dropdown"),T=h("FileUpload");return d(),c("div",O,[s("div",z,[s("div",E,[i(U),i(C,{class:"mb-4"},{start:u(()=>[s("div",G,[i(D,{label:"Print",icon:"pi pi-print",class:"p-button-success mr-2",onClick:m.onPrint},null,8,["onClick"])])]),end:u(()=>[]),_:1}),i(V,{ref:"dt",value:e.Documents,selection:e.selectedDocuments,"onUpdate:selection":t[1]||(t[1]=l=>e.selectedDocuments=l),dataKey:"id",paginator:!0,rows:10,filters:e.filters,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:"Showing {first} to {last} of {totalRecords} Documents",responsiveLayout:"scroll"},{header:u(()=>[s("div",R,[J,s("span",q,[H,i(y,{modelValue:e.filters.global.value,"onUpdate:modelValue":t[0]||(t[0]=l=>e.filters.global.value=l),placeholder:"Search..."},null,8,["modelValue"])])])]),default:u(()=>[i(b,{field:"created_at",header:"Tgl",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[W,x(" "+p(m.formatDate(l.data.created_at)),1)]),_:1}),i(b,{field:"title",header:"Judul",sortable:!0,headerStyle:"width:14%; min-width:10rem;"}),i(b,{field:"no_sk",header:"No SK",sortable:!0,headerStyle:"width:14%; min-width:10rem;"},{body:u(l=>[Z,x(" "+p(l.data.no_sk),1)]),_:1}),i(b,{field:"program",header:"Program",sortable:!0,headerStyle:"width:14%; min-width:10rem;"}),i(b,{field:"downloader",header:"Downloader",sortable:!0,headerStyle:"width:14%; min-width:10rem;"})]),_:1},8,["value","selection","filters"]),i(S,{visible:e.PrintDistribusiDialog,"onUpdate:visible":t[5]||(t[5]=l=>e.PrintDistribusiDialog=l),style:{width:"450px"},header:"Print Distribusi",modal:!0,class:"p-fluid"},{default:u(()=>[Q,s("div",X,[s("div",$,[ee,i(k,{id:"date1",modelValue:e.date1,"onUpdate:modelValue":t[2]||(t[2]=l=>e.date1=l),dateFormat:"dd-mm-yy",class:g({"p-invalid":e.submitted&&!e.date2&&!e.valid_date})},null,8,["modelValue","class"]),e.submitted&&!e.date1&&!e.valid_date?(d(),c("small",te,"Harus diisi.")):_("",!0)]),s("div",oe,[le,i(k,{id:"date2",modelValue:e.date2,"onUpdate:modelValue":t[3]||(t[3]=l=>e.date2=l),dateFormat:"dd-mm-yy",class:g({"p-invalid":e.submitted&&!e.date2&&!e.valid_date})},null,8,["modelValue","class"]),e.submitted&&!e.date2&&!e.valid_date?(d(),c("small",se,"Harus diisi.")):_("",!0)])]),s("div",ie,[i(D,{label:"Print",icon:"pi pi-print",class:"p-button-success",onClick:t[4]||(t[4]=l=>m.print())})])]),_:1},8,["visible"]),i(S,{visible:e.DocumentDialog,"onUpdate:visible":t[12]||(t[12]=l=>e.DocumentDialog=l),style:{width:"1024px"},header:"Document Internal Details",modal:!0,class:"p-fluid"},{footer:u(()=>[i(D,{label:"Cancel",icon:"pi pi-times",class:"p-button-text",onClick:m.hideDialog},null,8,["onClick"]),i(D,{label:"Save",icon:"pi pi-check",class:"p-button-text",onClick:m.saveDocument},null,8,["onClick"])]),default:u(()=>[s("div",ne,[s("div",ae,[re,i(k,{id:"tahun",modelValue:e.Document.tahun,"onUpdate:modelValue":t[6]||(t[6]=l=>e.Document.tahun=l),view:"year",dateFormat:"yy"},null,8,["modelValue"])]),s("div",ue,[ce,i(P,{id:"categoryDocument",modelValue:e.editPickExtra.categoryDocument,"onUpdate:modelValue":t[7]||(t[7]=l=>e.editPickExtra.categoryDocument=l),options:e.categoryDocument,optionLabel:"label",optionValue:"value",placeholder:"Pilih Kategori Document (SOP TU/GIZI dll)",onChange:m.onCategoryDocumentChange},{value:u(l=>[l.value&&l.value.value?(d(),c("div",de,[s("span",{class:g("Document-badge status-"+l.value.value)},p(l.value.label),3)])):l.value&&!l.value.value?(d(),c("div",me,[s("span",{class:g("Document-badge status-"+l.value.toLowerCase())},p(l.value),3)])):(d(),c("span",he,p(l.placeholder),1))]),_:1},8,["modelValue","options","onChange"])])]),s("div",De,[s("div",pe,[ge,i(y,{id:"titleDocument",modelValue:e.Document.category,"onUpdate:modelValue":t[8]||(t[8]=l=>e.Document.category=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:g({"p-invalid":e.submitted&&!e.Document.category})},null,8,["modelValue","class"]),e.submitted&&!e.Document.category?(d(),c("small",_e,"Kategori Document harus diisi.")):_("",!0)]),s("div",fe,[be,i(y,{id:"titleDocument",modelValue:e.Document.title,"onUpdate:modelValue":t[9]||(t[9]=l=>e.Document.title=l),modelModifiers:{trim:!0},required:"true",autofocus:"",class:g({"p-invalid":e.submitted&&!e.Document.title})},null,8,["modelValue","class"]),e.submitted&&!e.Document.title?(d(),c("small",ve,"Judul Document harus diisi.")):_("",!0)]),s("div",ye,[ke,i(k,{class:g({"p-invalid":e.submitted&&!e.Document.tgl_terbit}),id:"dateformat",modelValue:e.Document.tgl_terbit,"onUpdate:modelValue":t[10]||(t[10]=l=>e.Document.tgl_terbit=l),dateFormat:"dd-mm-yy"},null,8,["class","modelValue"]),e.submitted&&!e.Document.tgl_terbit?(d(),c("small",Se,"tgl terbit Document harus diisi.")):_("",!0)]),s("div",xe,[we,i(y,{id:"noSK",modelValue:e.Document.no_sk,"onUpdate:modelValue":t[11]||(t[11]=l=>e.Document.no_sk=l),modelModifiers:{trim:!0},required:"true",autofocus:""},null,8,["modelValue"])])]),Ue,s("div",Ce,[(d(!0),c(K,null,N(e.Document.arsips,l=>(d(),c("div",Ve,[s("div",Pe,[s("a",{class:"text-900 col-8",href:m.parseArsipUrls(l.storagepath),target:"_blank"},[s("div",Ye,p(l.filename),1)],8,Te),i(D,{class:"col-4 p-button-raised p-button-rounded p-button-danger",icon:"pi pi-times",onClick:Ee=>m.deleteUpload(l.storagepath)},null,8,["onClick"])])]))),256))]),s("div",Ie,[Me,i(T,{accept:".pdf,.docx,.doc,.jpg,.jpeg,.png,.xls,.xlsx,.tif",maxFileSize:15e6,label:"upload",chooseLabel:"Tambah",class:"mr-2 inline-block",name:"files[]",url:e.uploadUrl,onBeforeSend:m.onBeforeSendUploader,onUpload:m.onUploadSuccess},null,8,["url","onBeforeSend","onUpload"])])]),_:1},8,["visible"]),i(S,{visible:e.deleteDocumentDialog,"onUpdate:visible":t[14]||(t[14]=l=>e.deleteDocumentDialog=l),style:{width:"450px"},header:"Konfirmasi",modal:!0},{footer:u(()=>[i(D,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:t[13]||(t[13]=l=>e.deleteDocumentDialog=!1)}),i(D,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:m.deleteDocument},null,8,["onClick"])]),default:u(()=>[s("div",Ae,[Ke,e.Document?(d(),c("span",Ne,[Be,s("b",null,p(e.Document.no_Document),1),Fe])):_("",!0)])]),_:1},8,["visible"]),i(S,{visible:e.deleteDocumentsDialog,"onUpdate:visible":t[16]||(t[16]=l=>e.deleteDocumentsDialog=l),style:{width:"450px"},header:"Konfirmasi",modal:!0},{footer:u(()=>[i(D,{label:"No",icon:"pi pi-times",class:"p-button-text",onClick:t[15]||(t[15]=l=>e.deleteDocumentsDialog=!1)}),i(D,{label:"Yes",icon:"pi pi-check",class:"p-button-text",onClick:m.deleteSelectedDocuments},null,8,["onClick"])]),default:u(()=>[s("div",Le,[je,e.Document?(d(),c("span",Oe,"Yakin akan menghapus karena juga akan menghapus data upload yang terpilih? ")):_("",!0)])]),_:1},8,["visible"])])])])}const Re=Y(j,[["render",ze],["__scopeId","data-v-e6ce06c0"]]);export{Re as default};
